/*
 EventEmitter v2.0.0

 Copyright 2011, Oliver Caldwell (olivercaldwell.co.uk)
 Dual licensed under the MIT or GPL Version 2 licenses.
 https://github.com/Wolfy87/EventEmitter
*/
var i=null;
function m(){var a=this,b={},c=i,n=i,j=i;a.addListener=function(f,c){b[f]?b[f].push(c):b[f]=[c];a.a("newListener",f,c);return a};a.d=a.addListener;a.a=function(a){if(b[a]){n=Array.prototype.slice.call(arguments,1);for(c=0;c<b[a].length;c+=1)b[a][c].apply(i,n)}};a.c=function(a){b[a]||(b[a]=[]);return b[a]};a.e=function(b,c){function d(){c.apply(i,arguments);a.b(b,d)}a.addListener(b,d);return a};a.b=function(a,l){if(b[a]){a:{var d=b[a];if(d.indexOf)j=d.indexOf(l);else{for(c=0;c<d.length;c+=1)if(d[c]===
l){j=c;break a}j=-1}}j!==-1&&b[a].splice(j,1)}else b[a]=[]};a.f=function(c){b[c]=[];return a}};/*
 SCD.js.

 Copyright 2011, Guillaume Marty (edo999@gmail.com)
 Dual licensed under the MIT or GPL Version 2 licenses.
 https://github.com/gmarty/SCD.js
*/
function K(a,b,c){function n(a,b){return a-b}function j(a){return a.reduce(function(a,b){return a+b})/t}function f(){if(!o)if(p==="FastForwardMode"&&(a.ended||k>a.duration))l();else{F.drawImage(a,0,0,q,r,0,0,g,h);var b;b=[];var c=F.getImageData(0,0,g,h).data,d=G.getImageData(0,0,g,h).data,e=c.length;do b.push(Math.sqrt(Math.pow(c[e-4]-d[e-4],2)+Math.pow(c[e+-3]-d[e+-3],2)+Math.pow(c[e+-2]-d[e+-2],2)));while(e-=4);e=H(b);u?(d=j(b),c=Math.max.apply(i,b),b=Math.min.apply(i,b),b=[e,d,c,b]):b=[e];if(b[0]>
z&&(I.a("scenecut"),A.sceneTimecodes.push(k),u)){var c=document.createElement("div"),d=document.createElement("canvas"),e=d.width=q/2,f=d.height=r/2;d.getContext("2d").drawImage(a,0,0,q,r,0,0,e,f);c.appendChild(document.createTextNode("@ "+k));c.appendChild(document.createElement("br"));c.appendChild(d);c.appendChild(document.createElement("br"));c.appendChild(document.createTextNode("max: "+Math.round(b[2]/s)+"%, avg: "+Math.round(b[1]/s)+"%, med: "+Math.round(b[0]/s)+"%, min: "+Math.round(b[3]/
s)+"%"));v.appendChild(c)}G.drawImage(w,0,0,g,h,0,0,g,h)}}function l(){c&&c();A.stop()}function d(){if(this.currentTime-B>=x)k=this.currentTime,f(),B=this.currentTime}function C(){f();k+=x;this.currentTime=k}function D(){a.width=a.width?a.width:a.videoWidth;a.height=a.height?a.height:a.videoHeight;a.videoWidth/a.videoHeight>a.width/a.height?(q=a.width,r=a.videoHeight/a.videoWidth*a.width):(q=a.videoWidth/a.videoHeight*a.height,r=a.height);w.width=E.width=g;w.height=E.height=h;a.removeEventListener("durationchange",
D,!1)}if(!a||a.constructor.toString().indexOf("HTMLVideoElement")<0)throw"Inputed element is not a video element.";var A=this,p="FastForwardMode",g=50,h=50,x=0.25,z=25,u=!1,s=Math.sqrt(195075)/100,k=0,B=0,q=0,r=0,J=a.controls,w=document.createElement("canvas"),E=document.createElement("canvas"),F=w.getContext("2d"),G=E.getContext("2d"),o=!1,t,y,v,I,H;K.prototype.events=I=new m;(function(){b=b||{};b.mode&&b.mode==="PlaybackMode"&&(p=b.mode);b.step_width&&b.step_height?(g=parseInt(b.step_width,10),
h=parseInt(b.step_height,10)):b.step&&(g=h=parseInt(b.step,10));b.minSceneDuration&&(x=parseFloat(b.minSceneDuration));b.threshold&&(z=parseFloat(b.threshold));b.debug&&(u=Boolean(b.debug));B=x;z*=s;t=g*h;y=(t+1)/2-1;if(u)v=document.createElement("div"),v.className="scd-debug",document.getElementsByTagName("body")[0].appendChild(v);a.readyState<3?a.addEventListener("durationchange",D,!1):D();K.prototype.start=p==="FastForwardMode"?function(){if(!o)a.controls=!1,a.currentTime=k,a.addEventListener("seeked",
C,!1),f()}:function(){if(!o)a.controls=!1,a.currentTime=0,a.addEventListener("timeupdate",d,!1),a.addEventListener("ended",l,!1),a.play()};H=t%2?function(a){a.sort(n);return a[y]}:function(a){a.sort(n);return(a[y-0.5]+a[y+0.5])/2}})();K.prototype.pause=function(){if(!o){if(p==="FastForwardMode")a.controls=J,a.removeEventListener("seeked",C,!1);a.pause()}};K.prototype.stop=function(){A.pause();p==="FastForwardMode"?(a.removeEventListener("seeked",C,!1),a.controls=J):(a.removeEventListener("timeupdate",
d,!1),a.removeEventListener("ended",l,!1));o=!0}}K.prototype.sceneTimecodes=[];window.Scd=K;
