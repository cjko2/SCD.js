var h=false;
function j(b,f,z){function A(a,c){return a-c}function I(a){return a.reduce(function(c,e){return c+e})/k}function u(){if(!l)if(m==="FastForwardMode"&&(b.ended||i>b.duration))B();else{C.drawImage(b,0,0,o,p,0,0,d,d);var a;a=[];var c=C.getImageData(0,0,d,d).data,e=D.getImageData(0,0,d,d).data,g=c.length;do a.push(Math.sqrt(Math.pow(c[g-4]-e[g-4],2)+Math.pow(c[g+-3]-e[g+-3],2)+Math.pow(c[g+-2]-e[g+-2],2)));while(g-=4);e=I(a);if(q){c=Math.max.apply(null,a);g=Math.min.apply(null,a);a=E(a);a=[e,a,c,g]}else a=
[e];if(a[0]>v){w.sceneTimecodes.push(i);if(q){c=document.createElement("div");e=document.createElement("canvas");g=e.width=o/2;var J=e.height=p/2;e.getContext("2d").drawImage(b,0,0,o,p,0,0,g,J);c.appendChild(e);c.appendChild(document.createElement("br"));c.appendChild(document.createTextNode("max: "+Math.round(a[2]/n)+"%, avg: "+Math.round(a[0]/n)+"%, med: "+Math.round(a[1]/n)+"%, min: "+Math.round(a[3]/n)+"%"));r.appendChild(c)}}D.drawImage(s,0,0,d,d,0,0,d,d)}}function B(){z&&z();w.stop()}function K(){if(this.currentTime-
x>=t){i=this.currentTime;u();x=this.currentTime}}function F(){u();i+=t;this.currentTime=i}function G(){o=this.videoWidth;p=this.videoHeight;s.width=d;s.height=d;y.width=d;y.height=d;this.removeEventListener("durationchange",G,h)}if(!b||b.constructor.toString().indexOf("HTMLVideoElement")<0)throw"Inputed element is not a video element.";var w=this,m="FastForwardMode",d=50,t=0.25,v=25,q=h,n=Math.sqrt(195075)/100,i=0,x=0,o=0,p=0,H=b.controls,s=document.createElement("canvas"),y=document.createElement("canvas"),
C=s.getContext("2d"),D=y.getContext("2d"),l=h,k,r,E;(function(){if(f){if(f.mode&&f.mode==="PlaybackMode")m=f.mode;if(f.step)d=parseInt(f.step,10);if(f.minSceneDuration)t=parseFloat(f.minSceneDuration);if(f.threshold)v=parseFloat(f.threshold);if(f.debug)q=Boolean(f.debug);x=t}v*=n;k=d*d;if(q){r=document.createElement("div");r.className="scd-debug";document.getElementsByTagName("body")[0].appendChild(r)}b.addEventListener("durationchange",G,h);j.prototype.start=m==="FastForwardMode"?function(){if(!l){b.controls=
h;b.currentTime=i;b.addEventListener("seeked",F,h);u()}}:function(){if(!l){b.controls=h;b.currentTime=0;b.addEventListener("timeupdate",K,h);b.addEventListener("ended",B,h);b.play()}};E=k%2?function(a){a.sort(A);return a[(k+1)/2-1]}:function(a){a.sort(A);var c=(k+1)/2;return(a[c-1.5]+a[c-0.5])/2}})();j.prototype.pause=function(){if(!l){if(m==="FastForwardMode"){b.controls=H;b.removeEventListener("seeked",F,h)}b.pause()}};j.prototype.stop=function(){w.pause();if(m==="FastForwardMode")b.controls=H;
l=true}}j.prototype.sceneTimecodes=[];window.Scd=j;
