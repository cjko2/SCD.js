/*
 EventEmitter v2.0.0

 Copyright 2011, Oliver Caldwell (olivercaldwell.co.uk)
 Dual licensed under the MIT or GPL Version 2 licenses.
 https://github.com/Wolfy87/EventEmitter
*/
var i=null;
function m(){var a=this,b={},c=i,o=i,j=i;a.addListener=function(f,c){b[f]?b[f].push(c):b[f]=[c];a.a("newListener",f,c);return a};a.d=a.addListener;a.a=function(a){if(b[a]){o=Array.prototype.slice.call(arguments,1);for(c=0;c<b[a].length;c+=1)b[a][c].apply(i,o)}};a.c=function(a){b[a]||(b[a]=[]);return b[a]};a.e=function(b,c){function d(){c.apply(i,arguments);a.b(b,d)}a.addListener(b,d);return a};a.b=function(a,l){if(b[a]){a:{var d=b[a];if(d.indexOf)j=d.indexOf(l);else{for(c=0;c<d.length;c+=1)if(d[c]===
l){j=c;break a}j=-1}}j!==-1&&b[a].splice(j,1)}else b[a]=[]};a.f=function(c){b[c]=[];return a}};/*
 SCD.js.

 Copyright 2011, Guillaume Marty (edo999@gmail.com)
 Dual licensed under the MIT or GPL Version 2 licenses.
 https://github.com/gmarty/SCD.js
*/
function J(a,b,c){function o(a,b){return a-b}function j(a){return a.reduce(function(a,b){return a+b})/p}function f(){if(!q)if(n==="FastForwardMode"&&(a.ended||k>a.duration))l();else{E.drawImage(a,0,0,r,s,0,0,g,h);var b;b=[];var c=E.getImageData(0,0,g,h).data,d=F.getImageData(0,0,g,h).data,e=c.length;do b.push(Math.sqrt(Math.pow(c[e-4]-d[e-4],2)+Math.pow(c[e+-3]-d[e+-3],2)+Math.pow(c[e+-2]-d[e+-2],2)));while(e-=4);e=G(b);u?(d=j(b),c=Math.max.apply(i,b),b=Math.min.apply(i,b),b=[e,d,c,b]):b=[e];if(b[0]>
y&&(H.a("scenecut"),z.sceneTimecodes.push(k),u)){var c=document.createElement("div"),d=document.createElement("canvas"),e=d.width=r/2,f=d.height=s/2;d.getContext("2d").drawImage(a,0,0,r,s,0,0,e,f);c.appendChild(document.createTextNode("@ "+k));c.appendChild(document.createElement("br"));c.appendChild(d);c.appendChild(document.createElement("br"));c.appendChild(document.createTextNode("max: "+Math.round(b[2]/t)+"%, avg: "+Math.round(b[1]/t)+"%, med: "+Math.round(b[0]/t)+"%, min: "+Math.round(b[3]/
t)+"%"));v.appendChild(c)}F.drawImage(w,0,0,g,h,0,0,g,h)}}function l(){c&&c();z.stop()}function d(){if(this.currentTime-A>=x)k=this.currentTime,f(),A=this.currentTime}function B(){f();k+=x;this.currentTime=k}function C(){a.width=a.width?a.width:a.videoWidth;a.height=a.height?a.height:a.videoHeight;a.videoWidth/a.videoHeight>a.width/a.height?(r=a.width,s=a.videoHeight/a.videoWidth*a.width):(r=a.videoWidth/a.videoHeight*a.height,s=a.height);w.width=g;w.height=h;D.width=g;D.height=h;a.removeEventListener("durationchange",
C,!1)}if(!a||a.constructor.toString().indexOf("HTMLVideoElement")<0)throw"Inputed element is not a video element.";var z=this,n="FastForwardMode",g=50,h=50,x=0.25,y=25,u=!1,t=Math.sqrt(195075)/100,k=0,A=0,r=0,s=0,I=a.controls,w=document.createElement("canvas"),D=document.createElement("canvas"),E=w.getContext("2d"),F=D.getContext("2d"),q=!1,p,v,H,G;J.prototype.events=H=new m;(function(){if(b)b.mode&&b.mode==="PlaybackMode"&&(n=b.mode),b.step_width&&b.step_height?(g=parseInt(b.step_width,10),h=parseInt(b.step_height,
10)):b.step&&(g=parseInt(b.step,10),h=parseInt(b.step,10)),b.minSceneDuration&&(x=parseFloat(b.minSceneDuration)),b.threshold&&(y=parseFloat(b.threshold)),b.debug&&(u=Boolean(b.debug)),A=x;y*=t;p=g*h;if(u)v=document.createElement("div"),v.className="scd-debug",document.getElementsByTagName("body")[0].appendChild(v);a.readyState<3?a.addEventListener("durationchange",C,!1):C();J.prototype.start=n==="FastForwardMode"?function(){if(!q)a.controls=!1,a.currentTime=k,a.addEventListener("seeked",B,!1),f()}:
function(){if(!q)a.controls=!1,a.currentTime=0,a.addEventListener("timeupdate",d,!1),a.addEventListener("ended",l,!1),a.play()};G=p%2?function(a){a.sort(o);return a[(p+1)/2-1]}:function(a){a.sort(o);var b=(p+1)/2;return(a[b-1.5]+a[b-0.5])/2}})();J.prototype.pause=function(){if(!q){if(n==="FastForwardMode")a.controls=I,a.removeEventListener("seeked",B,!1);a.pause()}};J.prototype.stop=function(){z.pause();if(n==="FastForwardMode")a.controls=I;n==="FastForwardMode"?a.removeEventListener("seeked",B,!1):
(a.removeEventListener("timeupdate",d,!1),a.removeEventListener("ended",l,!1));q=!0}}J.prototype.sceneTimecodes=[];window.Scd=J;
