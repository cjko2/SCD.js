/*
 EventEmitter v2.0.0.

 Copyright 2011, Oliver Caldwell (olivercaldwell.co.uk)
 Dual licensed under the MIT or GPL Version 2 licenses.
 https://github.com/Wolfy87/EventEmitter
*/
'use strict';var e=null,l=!1;
function n(){var a=this,b={},c=e,k=e,h=e;a.addListener=function(f,c){b[f]?b[f].push(c):b[f]=[c];a.a("newListener",f,c);return a};a.c=a.addListener;a.a=function(a){if(b[a]){k=Array.prototype.slice.call(arguments,1);for(c=0;c<b[a].length;c+=1)b[a][c].apply(e,k)}};a.b=function(a){b[a]||(b[a]=[]);return b[a]};a.d=function(b,c){function d(){c.apply(e,arguments);a.removeListener(b,d)}a.addListener(b,d);return a};a.removeListener=function(f,k){if(b[f]){a:{var d=b[f];if(d.indexOf)h=d.indexOf(k);else{for(c=
0;c<d.length;c+=1)if(d[c]===k){h=c;break a}h=-1}}-1!==h&&b[f].splice(h,1)}else b[f]=[];return a};a.e=function(c){b[c]=[];return a}};/*
 SCD.js.

 Copyright 2011, Guillaume Marty (edo999@gmail.com)
 Dual licensed under the MIT or GPL Version 2 licenses.
 https://github.com/gmarty/SCD.js
*/
function K(a,b,c){function k(a,b){return a-b}function h(){if(!o)if("FastForwardMode"===p&&(a.ended||m>a.duration))f();else{F.drawImage(a,0,0,q,r,0,0,i,j);var b;b=[];var c=F.getImageData(0,0,i,j).data,d=G.getImageData(0,0,i,j).data,g=c.length;do b.push(Math.sqrt(Math.pow(c[g-4]-d[g-4],2)+Math.pow(c[g+-3]-d[g+-3],2)+Math.pow(c[g+-2]-d[g+-2],2)));while(g-=4);g=H(b);t?(d=b.reduce(function(a,b){return a+b})/u,c=Math.max.apply(e,b),b=Math.min.apply(e,b),b=[g,d,c,b]):b=[g];if(b[0]>v&&(I.a("scenecut"),A.sceneTimecodes.push(m),
t)){var c=document.createElement("div"),d=document.createElement("canvas"),g=d.width=q/2,h=d.height=r/2;d.getContext("2d").drawImage(a,0,0,q,r,0,0,g,h);c.appendChild(document.createTextNode("@ "+m));c.appendChild(document.createElement("br"));c.appendChild(d);c.appendChild(document.createElement("br"));c.appendChild(document.createTextNode("max: "+Math.round(b[2]/s)+"%, avg: "+Math.round(b[1]/s)+"%, med: "+Math.round(b[0]/s)+"%, min: "+Math.round(b[3]/s)+"%"));w.appendChild(c)}G.drawImage(x,0,0,i,
j,0,0,i,j)}}function f(){c&&c();A.stop()}function E(){this.currentTime-B>=y&&(m=this.currentTime,h(),B=this.currentTime)}function d(){h();this.currentTime=m+=y}function C(){a.width=a.width?a.width:a.videoWidth;a.height=a.height?a.height:a.videoHeight;a.videoWidth/a.videoHeight>a.width/a.height?(q=a.width,r=a.videoHeight/a.videoWidth*a.width):(q=a.videoWidth/a.videoHeight*a.height,r=a.height);x.width=D.width=i;x.height=D.height=j;a.removeEventListener("durationchange",C,l)}if(!a||0>a.constructor.toString().indexOf("HTMLVideoElement"))throw"Inputed element is not a video element.";
var A=this,p="FastForwardMode",i=50,j=50,y=0.25,v=25,t=l,s=Math.sqrt(195075)/100,m=0,B=0,q=0,r=0,J=a.controls,x=document.createElement("canvas"),D=document.createElement("canvas"),F=x.getContext("2d"),G=D.getContext("2d"),o=l,u,z,w,I,H;K.prototype.events=I=new n;b=b||{};b.mode&&"PlaybackMode"===b.mode&&(p=b.mode);b.step_width&&b.step_height?(i=parseInt(b.step_width,10),j=parseInt(b.step_height,10)):b.step&&(i=j=parseInt(b.step,10));b.minSceneDuration&&(y=parseFloat(b.minSceneDuration));b.threshold&&
(v=parseFloat(b.threshold));b.debug&&(t=Boolean(b.debug));B=y;v*=s;u=i*j;z=(u+1)/2-1;t&&(w=document.createElement("div"),w.className="scd-debug",document.getElementsByTagName("body")[0].appendChild(w));3>a.readyState?a.addEventListener("durationchange",C,l):C();K.prototype.start="FastForwardMode"===p?function(){if(!o){a.controls=l;a.currentTime=m;a.addEventListener("seeked",d,l);h()}}:function(){if(!o){a.controls=l;a.currentTime=0;a.addEventListener("timeupdate",E,l);a.addEventListener("ended",f,
l);a.play()}};H=u%2?function(a){a.sort(k);return a[z]}:function(a){a.sort(k);return(a[z-0.5]+a[z+0.5])/2};K.prototype.pause=function(){if(!o){if(p==="FastForwardMode"){a.controls=J;a.removeEventListener("seeked",d,l)}a.pause()}};K.prototype.stop=function(){A.pause();if(p==="FastForwardMode"){a.removeEventListener("seeked",d,l);a.controls=J}else{a.removeEventListener("timeupdate",E,l);a.removeEventListener("ended",f,l)}o=true}}K.prototype.sceneTimecodes=[];window.Scd=K;
