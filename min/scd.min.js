/*
 EventEmitter v2.0.0

 Copyright 2011, Oliver Caldwell (olivercaldwell.co.uk)
 Dual licensed under the MIT or GPL Version 2 licenses.
 https://github.com/Wolfy87/EventEmitter
*/
var k=null;
function n(){var a=this,b={},c=k,i=k,l=k;a.addListener=function(j,c){b[j]?b[j].push(c):b[j]=[c];a.a("newListener",j,c);return a};a.d=a.addListener;a.a=function(a){if(b[a]){i=Array.prototype.slice.call(arguments,1);for(c=0;c<b[a].length;c+=1)b[a][c].apply(k,i)}};a.c=function(a){b[a]||(b[a]=[]);return b[a]};a.e=function(b,c){function e(){c.apply(k,arguments);a.b(b,e)}a.addListener(b,e);return a};a.b=function(a,i){if(b[a]){a:{var e=b[a];if(e.indexOf)l=e.indexOf(i);else{for(c=0;c<e.length;c+=1)if(e[c]===
i){l=c;break a}l=-1}}l!==-1&&b[a].splice(l,1)}else b[a]=[]};a.f=function(c){b[c]=[];return a}};/*
 SCD.js.

 Copyright 2011, Guillaume Marty (edo999@gmail.com)
 Dual licensed under the MIT or GPL Version 2 licenses.
 https://github.com/gmarty/SCD.js
*/
function K(a,b,c){function i(a,b){return a-b}function l(a){return a.reduce(function(a,b){return a+b})/o}function j(){if(!p)if(q==="FastForwardMode"&&(a.ended||m>a.duration))D();else{E.drawImage(a,0,0,r,s,0,0,g,h);var b;b=[];var c=E.getImageData(0,0,g,h).data,f=F.getImageData(0,0,g,h).data,d=c.length;do b.push(Math.sqrt(Math.pow(c[d-4]-f[d-4],2)+Math.pow(c[d+-3]-f[d+-3],2)+Math.pow(c[d+-2]-f[d+-2],2)));while(d-=4);d=G(b);u?(f=l(b),c=Math.max.apply(k,b),b=Math.min.apply(k,b),b=[d,f,c,b]):b=[d];if(b[0]>
y&&(H.a("scenecut"),z.sceneTimecodes.push(m),u)){var c=document.createElement("div"),f=document.createElement("canvas"),d=f.width=r/2,e=f.height=s/2;f.getContext("2d").drawImage(a,0,0,r,s,0,0,d,e);c.appendChild(document.createTextNode("@ "+m));c.appendChild(document.createElement("br"));c.appendChild(f);c.appendChild(document.createElement("br"));c.appendChild(document.createTextNode("max: "+Math.round(b[2]/t)+"%, avg: "+Math.round(b[1]/t)+"%, med: "+Math.round(b[0]/t)+"%, min: "+Math.round(b[3]/
t)+"%"));v.appendChild(c)}F.drawImage(w,0,0,g,h,0,0,g,h)}}function D(){c&&c();z.stop()}function e(){if(this.currentTime-A>=x)m=this.currentTime,j(),A=this.currentTime}function I(){j();m+=x;this.currentTime=m}function B(){a.width=a.width?a.width:a.videoWidth;a.height=a.height?a.height:a.videoHeight;a.videoWidth/a.videoHeight>a.width/a.height?(r=a.width,s=a.videoHeight/a.videoWidth*a.width):(r=a.videoWidth/a.videoHeight*a.height,s=a.height);w.width=g;w.height=h;C.width=g;C.height=h;a.removeEventListener("durationchange",
B,!1)}if(!a||a.constructor.toString().indexOf("HTMLVideoElement")<0)throw"Inputed element is not a video element.";var z=this,q="FastForwardMode",g=50,h=50,x=0.25,y=25,u=!1,t=Math.sqrt(195075)/100,m=0,A=0,r=0,s=0,J=a.controls,w=document.createElement("canvas"),C=document.createElement("canvas"),E=w.getContext("2d"),F=C.getContext("2d"),p=!1,o,v,H,G;K.prototype.events=H=new n;(function(){if(b)b.mode&&b.mode==="PlaybackMode"&&(q=b.mode),b.step_width&&b.step_height?(g=parseInt(b.step_width,10),h=parseInt(b.step_height,
10)):b.step&&(g=parseInt(b.step,10),h=parseInt(b.step,10)),b.minSceneDuration&&(x=parseFloat(b.minSceneDuration)),b.threshold&&(y=parseFloat(b.threshold)),b.debug&&(u=Boolean(b.debug)),A=x;y*=t;o=g*h;if(u)v=document.createElement("div"),v.className="scd-debug",document.getElementsByTagName("body")[0].appendChild(v);a.readyState<3?a.addEventListener("durationchange",B,!1):B();K.prototype.start=q==="FastForwardMode"?function(){if(!p)a.controls=!1,a.currentTime=m,a.addEventListener("seeked",I,!1),j()}:
function(){if(!p)a.controls=!1,a.currentTime=0,a.addEventListener("timeupdate",e,!1),a.addEventListener("ended",D,!1),a.play()};G=o%2?function(a){a.sort(i);return a[(o+1)/2-1]}:function(a){a.sort(i);var b=(o+1)/2;return(a[b-1.5]+a[b-0.5])/2}})();K.prototype.pause=function(){if(!p){if(q==="FastForwardMode")a.controls=J,a.removeEventListener("seeked",I,!1);a.pause()}};K.prototype.stop=function(){z.pause();if(q==="FastForwardMode")a.controls=J;p=!0}}K.prototype.sceneTimecodes=[];window.Scd=K;
