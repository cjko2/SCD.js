/*
 EventEmitter v2.0.0

 Copyright 2011, Oliver Caldwell (olivercaldwell.co.uk)
 Dual licensed under the MIT or GPL Version 2 licenses.
 https://github.com/Wolfy87/EventEmitter
*/
var k=null;
function n(){var b=this,a={},c=k,i=k,l=k;b.addListener=function(j,c){a[j]?a[j].push(c):a[j]=[c];b.a("newListener",j,c);return b};b.d=b.addListener;b.a=function(b){if(a[b]){i=Array.prototype.slice.call(arguments,1);for(c=0;c<a[b].length;c+=1)a[b][c].apply(k,i)}};b.c=function(b){a[b]||(a[b]=[]);return a[b]};b.e=function(a,c){function e(){c.apply(k,arguments);b.b(a,e)}b.addListener(a,e);return b};b.b=function(b,i){if(a[b]){a:{var e=a[b];if(e.indexOf)l=e.indexOf(i);else{for(c=0;c<e.length;c+=1)if(e[c]===
i){l=c;break a}l=-1}}l!==-1&&a[b].splice(l,1)}else a[b]=[]};b.f=function(c){a[c]=[];return b}};/*
 SCD.js.

 Copyright 2011, Guillaume Marty (edo999@gmail.com)
 Dual licensed under the MIT or GPL Version 2 licenses.
 https://github.com/gmarty/SCD.js
*/
function K(b,a,c){function i(b,a){return b-a}function l(b){return b.reduce(function(b,a){return b+a})/o}function j(){if(!p)if(q==="FastForwardMode"&&(b.ended||m>b.duration))C();else{D.drawImage(b,0,0,s,t,0,0,g,h);var a;a=[];var c=D.getImageData(0,0,g,h).data,f=E.getImageData(0,0,g,h).data,d=c.length;do a.push(Math.sqrt(Math.pow(c[d-4]-f[d-4],2)+Math.pow(c[d+-3]-f[d+-3],2)+Math.pow(c[d+-2]-f[d+-2],2)));while(d-=4);d=F(a);u?(f=l(a),c=Math.max.apply(k,a),a=Math.min.apply(k,a),a=[d,f,c,a]):a=[d];if(a[0]>
y&&(G.a("scenecut"),z.sceneTimecodes.push(m),u)){var c=document.createElement("div"),f=document.createElement("canvas"),d=f.width=s/2,e=f.height=t/2;f.getContext("2d").drawImage(b,0,0,s,t,0,0,d,e);c.appendChild(document.createTextNode("@ "+m));c.appendChild(document.createElement("br"));c.appendChild(f);c.appendChild(document.createElement("br"));c.appendChild(document.createTextNode("max: "+Math.round(a[2]/r)+"%, avg: "+Math.round(a[1]/r)+"%, med: "+Math.round(a[0]/r)+"%, min: "+Math.round(a[3]/
r)+"%"));v.appendChild(c)}E.drawImage(w,0,0,g,h,0,0,g,h)}}function C(){c&&c();z.stop()}function e(){if(this.currentTime-A>=x)m=this.currentTime,j(),A=this.currentTime}function H(){j();m+=x;this.currentTime=m}function I(){s=this.videoWidth;t=this.videoHeight;w.width=g;w.height=h;B.width=g;B.height=h;this.removeEventListener("durationchange",I,!1)}if(!b||b.constructor.toString().indexOf("HTMLVideoElement")<0)throw"Inputed element is not a video element.";var z=this,q="FastForwardMode",g=50,h=50,x=0.25,
y=25,u=!1,r=Math.sqrt(195075)/100,m=0,A=0,s=0,t=0,J=b.controls,w=document.createElement("canvas"),B=document.createElement("canvas"),D=w.getContext("2d"),E=B.getContext("2d"),p=!1,o,v,G;K.prototype.events=G=new n;var F;(function(){if(a)a.mode&&a.mode==="PlaybackMode"&&(q=a.mode),a.step_width&&a.step_height?(g=parseInt(a.step_width,10),h=parseInt(a.step_height,10)):a.step&&(g=parseInt(a.step,10),h=parseInt(a.step,10)),a.minSceneDuration&&(x=parseFloat(a.minSceneDuration)),a.threshold&&(y=parseFloat(a.threshold)),
a.debug&&(u=Boolean(a.debug)),A=x;y*=r;o=g*h;if(u)v=document.createElement("div"),v.className="scd-debug",document.getElementsByTagName("body")[0].appendChild(v);b.addEventListener("durationchange",I,!1);K.prototype.start=q==="FastForwardMode"?function(){if(!p)b.controls=!1,b.currentTime=m,b.addEventListener("seeked",H,!1),j()}:function(){if(!p)b.controls=!1,b.currentTime=0,b.addEventListener("timeupdate",e,!1),b.addEventListener("ended",C,!1),b.play()};F=o%2?function(a){a.sort(i);return a[(o+1)/
2-1]}:function(a){a.sort(i);var b=(o+1)/2;return(a[b-1.5]+a[b-0.5])/2}})();K.prototype.pause=function(){if(!p){if(q==="FastForwardMode")b.controls=J,b.removeEventListener("seeked",H,!1);b.pause()}};K.prototype.stop=function(){z.pause();if(q==="FastForwardMode")b.controls=J;p=!0}}K.prototype.sceneTimecodes=[];window.Scd=K;
